{% extends 'base.html.twig' %}

{% block title %}Edit Client{% endblock %}
{% block page_title %}Edit Client{% endblock %}

{% block stylesheets %}
{{ parent() }}
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css"/>
<link rel="stylesheet" href="{{ asset('style/css/CLIENT/client-edit.css') }}">  
{% endblock %}

{% block body %}
<section class="client-form-section">
    <div class="page-header">
        <h1>Edit Client</h1>
        <p>Update client information below.</p>
    </div>

    <div class="form-container">
        {{ form_start(form) }}
            {{ form_row(form.name) }}
            {{ form_row(form.email) }}
            {{ form_row(form.phone) }}
            {{ form_row(form.address) }}
            {{ form_row(form.status) }}

            <div class="form-actions">
                <a href="{{ path('app_client_index') }}" class="back-link">
                    ← Back to List
                </a>
                <button type="submit" class="btn btn-update">Update</button>
            </div>
        {{ form_end(form) }}

        <!-- Separate delete form (not nested) -->
        <form method="post" action="{{ path('app_client_delete', {'id': client.id}) }}"
              onsubmit="return confirm('Are you sure you want to delete this client?');"
              style="margin-top: 20px;">
            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ client.id) }}">
            <button class="btn btn-delete" type="submit">Delete Client</button>
        </form>
    </div>

    <section class="related-orders-section">
        <h2>Related Orders</h2>
        <div class="table-container">
            <table class="table" id="relatedTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Service</th>
                        <th>Total Price</th>
                        <th>Status</th>
                        <th>Order Date</th>
                        <th>Delivery Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% if client.orders|length > 0 %}
                        {% for order in client.orders %}
                        <tr>
                            <td>{{ order.id }}</td>
                            <td>{{ order.service ? order.service.name : 'N/A' }}</td>
                            <td>{{ order.totalPrice ? '₱' ~ order.totalPrice : 'N/A' }}</td>
                            <td>{{ order.status }}</td>
                            <td>{{ order.orderDate ? order.orderDate|date('Y-m-d H:i') : 'N/A' }}</td>
                            <td>{{ order.deliveryDate ? order.deliveryDate|date('Y-m-d') : 'N/A' }}</td>
                            <td>
                                <a href="{{ path('app_order_show', {'id': order.id}) }}" class="show-btn">Show</a>
                                <a href="{{ path('app_order_edit', {'id': order.id}) }}" class="edit-btn">Edit</a>
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr><td colspan="7" class="empty-state">No orders found for this client.</td></tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </section>
</section>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

{% if client.orders|length > 0 %}
<script>
$(document).ready(function() {
    $('#relatedTable').DataTable({
        paging: true,
        searching: true,
        ordering: true,
        info: true,
        pageLength: 10,
        lengthMenu: [5, 10, 20, 50],
        order: [[0, 'desc']],
        columnDefs: [
            { orderable: false, targets: -1 }
        ],
        language: {
            search: "Search:",
            lengthMenu: "Show _MENU_ entries",
            info: "Showing _START_ to _END_ of _TOTAL_ orders",
            infoEmpty: "Showing 0 to 0 of 0 orders",
            infoFiltered: "(filtered from _MAX_ total orders)",
            paginate: {
                first: "First",
                last: "Last",
                next: "Next",
                previous: "Previous"
            }
        }
    });
});
</script>
{% endif %}
{% endblock %}
